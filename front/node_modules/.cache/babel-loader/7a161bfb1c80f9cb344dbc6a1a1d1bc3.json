{"ast":null,"code":"import _classCallCheck from \"/home/findev/Documents/lyon-0218-js-zappo/front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/findev/Documents/lyon-0218-js-zappo/front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/findev/Documents/lyon-0218-js-zappo/front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/findev/Documents/lyon-0218-js-zappo/front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/findev/Documents/lyon-0218-js-zappo/front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"/home/findev/Documents/lyon-0218-js-zappo/front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"/home/findev/Documents/lyon-0218-js-zappo/front/src/components/ZappoOrdersTablette/OrderCard.js\";\nimport React, { Component } from \"react\";\nimport ReactToPrint from \"react-to-print\";\nimport Ticket from \"./Ticket\";\nimport { Card, CardHeader, CardContent, IconButton, Grid, Typography, List, ListItem, ListItemText, Button, Avatar } from \"@material-ui/core\";\nimport { LocalPizza, Print, LocalCafe, LocalDining, LocalBar, AccessTime } from \"@material-ui/icons\";\nimport axios from \"axios\";\nimport config from \"../../assets/lib/axiosStaff\";\nimport moment from \"moment\";\nimport { StyledCardActions } from \"../../styled/StyledOrdersNav\";\n\nvar OrderCard =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(OrderCard, _Component);\n\n  function OrderCard(props) {\n    var _this;\n\n    _classCallCheck(this, OrderCard);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(OrderCard).call(this, props));\n    _this.state = {\n      delay: \"\"\n    };\n    _this.handleStatus = _this.handleStatus.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.getDelay = _this.getDelay.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    return _this;\n  }\n\n  _createClass(OrderCard, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      setInterval(function () {\n        return _this2.getDelay();\n      }, 1000);\n    }\n  }, {\n    key: \"getDelay\",\n    value: function getDelay() {\n      var order = this.props.order;\n      var duration = moment.duration(moment(order.pending_time).diff(moment()));\n\n      if (duration.isValid) {\n        var _data = duration._data;\n        this.setState({\n          delay: moment.duration(_data).locale(\"fr\").humanize(true)\n        });\n      }\n    }\n  }, {\n    key: \"handleStatus\",\n    value: function handleStatus(id, status, chargeId) {\n      var updateStatus = this.props.updateStatus;\n      var newStatus = this.props.status[status];\n\n      if (chargeId) {\n        axios(config({\n          chargeId: chargeId\n        }, \"/\".concat(newStatus, \"/\").concat(id), \"post\")).then(function (res) {\n          var _res$data = res.data,\n              success = _res$data.success,\n              error = _res$data.error;\n\n          if (success) {\n            updateStatus({\n              message: success\n            });\n          }\n        }).catch(function (err) {\n          return console.log(err);\n        });\n      } else {\n        axios(config({}, \"/\".concat(newStatus, \"/\").concat(id), \"post\")).then(function (res) {\n          var _res$data2 = res.data,\n              success = _res$data2.success,\n              error = _res$data2.error;\n\n          if (success) {\n            updateStatus({\n              message: success\n            });\n          }\n        }).catch(function (err) {\n          return console.log(err);\n        });\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var order = this.props.order;\n      var delay = this.state.delay;\n      var products = order !== null ? renderProducts(order) : [];\n      var dense = products.length > 6 ? true : false;\n      return React.createElement(Card, {\n        style: {\n          width: \"100%\",\n          height: \"92vh\"\n        },\n        id: \"liste\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 91\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 92\n        },\n        __self: this\n      }, React.createElement(CardHeader, {\n        style: {\n          height: \"10vh\"\n        },\n        action: order.state !== \"0\" ? React.createElement(\"div\", {\n          style: {\n            marginTop: \"20px\"\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 97\n          },\n          __self: this\n        }, React.createElement(ReactToPrint, {\n          trigger: function trigger() {\n            return React.createElement(IconButton, {\n              component: \"a\",\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 100\n              },\n              __self: this\n            }, React.createElement(Print, {\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 101\n              },\n              __self: this\n            }));\n          },\n          content: function content() {\n            return _this3.componentRef;\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 98\n          },\n          __self: this\n        })) : null,\n        title: \"N\\xB0\".concat(order.id, \" - \").concat(order.user.name, \" - \").concat(order.user.phone.replace(/\\B(?=(\\d{2})+(?!\\d))/g, \" \")),\n        subheader: \"Commande n\\xB0 \".concat(order.id, \" lanc\\xE9e le \").concat(moment(order.pending_time).format('LL')),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 93\n        },\n        __self: this\n      }), React.createElement(CardContent, {\n        style: {\n          height: \"62vh\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 114\n        },\n        __self: this\n      }, React.createElement(List, {\n        style: {\n          height: \"52vh\",\n          overflow: \"auto\"\n        },\n        dense: dense,\n        id: \"listToPrint\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 115\n        },\n        __self: this\n      }, products), React.createElement(\"div\", {\n        className: \"hiddenPrint\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 122\n        },\n        __self: this\n      }, order.comments.length > 1 && React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 124\n        },\n        __self: this\n      }, React.createElement(Typography, {\n        variant: \"headline\",\n        style: {\n          marginTop: \"10px\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 125\n        },\n        __self: this\n      }, \"Commentaire :\"), React.createElement(Typography, {\n        variant: \"body1\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 128\n        },\n        __self: this\n      }, order.comments)))), React.createElement(DisplayActionsButton, {\n        className: \"hiddenPrint\",\n        id: order.id,\n        delay: delay,\n        status: order.state,\n        chargeId: order.chargeId,\n        handleStatus: this.handleStatus,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 133\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        style: {\n          height: \"0\",\n          overflow: \"hidden\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 141\n        },\n        __self: this\n      }, React.createElement(Ticket, {\n        order: this.props.order,\n        ref: function ref(el) {\n          return _this3.componentRef = el;\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 142\n        },\n        __self: this\n      }))));\n    }\n  }]);\n\n  return OrderCard;\n}(Component);\n\nvar DisplayActionsButton = function DisplayActionsButton(_ref) {\n  var id = _ref.id,\n      status = _ref.status,\n      handleStatus = _ref.handleStatus,\n      delay = _ref.delay,\n      chargeId = _ref.chargeId;\n  var pending = status === \"0\";\n  var validate = status === \"1\";\n  var finished = status === \"2\";\n  var canceled = status === \"3\";\n  return React.createElement(\"div\", {\n    className: \"hiddenPrint\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160\n    },\n    __self: this\n  }, React.createElement(StyledCardActions, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161\n    },\n    __self: this\n  }, !canceled && React.createElement(Grid, {\n    container: true,\n    justify: \"space-between\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163\n    },\n    __self: this\n  }, !finished && React.createElement(Grid, {\n    item: true,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165\n    },\n    __self: this\n  }, React.createElement(Button, {\n    onClick: function onClick() {\n      pending ? handleStatus(id, 1, chargeId) : handleStatus(id, 2);\n    },\n    variant: \"contained\",\n    size: \"large\",\n    color: \"primary\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 166\n    },\n    __self: this\n  }, pending ? \"Valider\" : \"Terminer\")), validate && React.createElement(Grid, {\n    item: true,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    style: {\n      backgroundColor: \"#e3e9f2\",\n      padding: \"8px 1rem\",\n      borderRadius: \"3px\",\n      border: \"1px solid rgb(0,158,224)\"\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180\n    },\n    __self: this\n  }, React.createElement(Typography, {\n    variant: \"button\",\n    color: \"primary\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188\n    },\n    __self: this\n  }, React.createElement(\"span\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189\n    },\n    __self: this\n  }, React.createElement(AccessTime, {\n    style: {\n      verticalAlign: \"sub\",\n      margin: \"0\",\n      padding: \"0\"\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 190\n    },\n    __self: this\n  }), \" \", \"Livraison : \", delay)))), pending && React.createElement(Grid, {\n    item: true,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 204\n    },\n    __self: this\n  }, React.createElement(Button, {\n    onClick: function onClick() {\n      handleStatus(id, 3, chargeId);\n    },\n    variant: \"contained\",\n    size: \"large\",\n    color: \"secondary\",\n    style: {\n      marginLeft: \"auto\"\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 205\n    },\n    __self: this\n  }, \"Refuser\")))));\n};\n\nvar renderProducts = function renderProducts(_ref2) {\n  var cart = _ref2.cart;\n\n  var GetIcon = function GetIcon(_ref3) {\n    var id = _ref3.id;\n\n    if (id === 1) {\n      return React.createElement(LocalPizza, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 228\n        },\n        __self: this\n      });\n    } else if (id === 2) {\n      return React.createElement(LocalDining, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 230\n        },\n        __self: this\n      });\n    } else if (id === 3) {\n      return React.createElement(LocalCafe, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 232\n        },\n        __self: this\n      });\n    } else if (id === 4) {\n      return React.createElement(LocalBar, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 234\n        },\n        __self: this\n      });\n    } else {\n      return null;\n    }\n  };\n\n  return cart.map(function (elt, i) {\n    return React.createElement(ListItem, {\n      divider: true,\n      key: i,\n      style: {\n        paddingLeft: 0\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 241\n      },\n      __self: this\n    }, React.createElement(Avatar, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 242\n      },\n      __self: this\n    }, React.createElement(GetIcon, {\n      id: elt.category_id,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 243\n      },\n      __self: this\n    })), React.createElement(ListItemText, {\n      primary: \"\".concat(elt.quantity, \" x \").concat(elt.name),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 245\n      },\n      __self: this\n    }));\n  });\n};\n\nexport default OrderCard;","map":{"version":3,"sources":["/home/findev/Documents/lyon-0218-js-zappo/front/src/components/ZappoOrdersTablette/OrderCard.js"],"names":["React","Component","ReactToPrint","Ticket","Card","CardHeader","CardContent","IconButton","Grid","Typography","List","ListItem","ListItemText","Button","Avatar","LocalPizza","Print","LocalCafe","LocalDining","LocalBar","AccessTime","axios","config","moment","StyledCardActions","OrderCard","props","state","delay","handleStatus","bind","getDelay","setInterval","order","duration","pending_time","diff","isValid","_data","setState","locale","humanize","id","status","chargeId","updateStatus","newStatus","then","res","data","success","error","message","catch","err","console","log","products","renderProducts","dense","length","width","height","marginTop","componentRef","user","name","phone","replace","format","overflow","comments","el","DisplayActionsButton","pending","validate","finished","canceled","backgroundColor","padding","borderRadius","border","verticalAlign","margin","marginLeft","cart","GetIcon","map","elt","i","paddingLeft","category_id","quantity"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport ReactToPrint from \"react-to-print\";\nimport Ticket from \"./Ticket\";\n\nimport {\n  Card,\n  CardHeader,\n  CardContent,\n  IconButton,\n  Grid,\n  Typography,\n  List,\n  ListItem,\n  ListItemText,\n  Button,\n  Avatar,\n} from \"@material-ui/core\";\nimport {\n  LocalPizza,\n  Print,\n  LocalCafe,\n  LocalDining,\n  LocalBar,\n  AccessTime\n} from \"@material-ui/icons\";\nimport axios from \"axios\";\nimport config from \"../../assets/lib/axiosStaff\";\nimport moment from \"moment\";\nimport { StyledCardActions } from \"../../styled/StyledOrdersNav\";\n\nclass OrderCard extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      delay: \"\"\n    };\n    this.handleStatus = this.handleStatus.bind(this);\n    this.getDelay = this.getDelay.bind(this);\n  }\n\n  componentDidMount() {\n    setInterval(() => this.getDelay(), 1000);\n  }\n\n  getDelay() {\n    const { order } = this.props;\n    const duration = moment.duration(\n      moment(order.pending_time).diff(moment())\n    );\n    if (duration.isValid) {\n      const { _data } = duration;\n      this.setState({\n        delay: moment\n          .duration(_data)\n          .locale(\"fr\")\n          .humanize(true)\n      });\n    }\n  }\n\n  handleStatus(id, status, chargeId) {\n    const {updateStatus} = this.props;\n    const newStatus = this.props.status[status];\n    if(chargeId){\n      axios(config({chargeId}, `/${newStatus}/${id}`, \"post\"))\n      .then(res => {\n        const { success, error } = res.data;\n        if (success) {\n          updateStatus({message:success});\n        }\n      })\n      .catch(err => console.log(err));\n    }else{\n      axios(config({}, `/${newStatus}/${id}`, \"post\"))\n      .then(res => {\n        const { success, error } = res.data;\n        if (success) {\n          updateStatus({ message: success })\n        }\n      })\n      .catch(err => console.log(err));\n    }\n  }\n\n  render() {\n    const { order } = this.props;\n    const { delay } = this.state;\n    const products = order !== null ? renderProducts(order) : [];\n    const dense = products.length > 6 ? true : false;\n    return (\n      <Card style={{ width: \"100%\", height: \"92vh\" }} id=\"liste\">\n        <div>\n          <CardHeader\n            style={{ height: \"10vh\" }}\n            action={\n              order.state !== \"0\" ? (\n                <div style={{ marginTop: \"20px\" }}>\n                  <ReactToPrint\n                    trigger={() => (\n                      <IconButton component=\"a\">\n                        <Print />\n                      </IconButton>\n                    )}\n                    content={() => this.componentRef}\n                  />\n                </div>\n              ) : null\n            }\n            title={`N°${order.id} - ${\n              order.user.name\n            } - ${order.user.phone.replace(/\\B(?=(\\d{2})+(?!\\d))/g, \" \")}`}\n            subheader={`Commande n° ${order.id} lancée le ${moment(order.pending_time).format('LL')}`}\n          />\n          <CardContent style={{ height: \"62vh\" }}>\n            <List\n              style={{ height: \"52vh\", overflow: \"auto\" }}\n              dense={dense}\n              id=\"listToPrint\"\n            >\n              {products}\n            </List>\n            <div className=\"hiddenPrint\">\n              {order.comments.length > 1 && (\n                <div>\n                  <Typography variant=\"headline\" style={{ marginTop: \"10px\" }}>\n                    Commentaire :\n                  </Typography>\n                  <Typography variant=\"body1\">{order.comments}</Typography>\n                </div>\n              )}\n            </div>\n          </CardContent>\n          <DisplayActionsButton\n            className=\"hiddenPrint\"\n            id={order.id}\n            delay={delay}\n            status={order.state}\n            chargeId={order.chargeId}\n            handleStatus={this.handleStatus}\n          />\n          <div style={{ height: \"0\", overflow: \"hidden\" }}>\n            <Ticket\n              order={this.props.order}\n              ref={el => (this.componentRef = el)}\n            />\n          </div>\n        </div>\n      </Card>\n    );\n  }\n}\n\nconst DisplayActionsButton = ({ id, status, handleStatus, delay, chargeId }) => {\n  const pending = status === \"0\";\n  const validate = status === \"1\";\n  const finished = status === \"2\";\n  const canceled = status === \"3\";\n\n  return (\n    <div className=\"hiddenPrint\">\n      <StyledCardActions>\n        {!canceled && (\n          <Grid container justify=\"space-between\">\n            {!finished && (\n              <Grid item>\n                <Button\n                  onClick={() => {\n                    pending ? handleStatus(id, 1,chargeId) : handleStatus(id, 2);\n                  }}\n                  variant=\"contained\"\n                  size=\"large\"\n                  color=\"primary\"\n                >\n                  {pending ? \"Valider\" : \"Terminer\"}\n                </Button>\n              </Grid>\n            )}\n            {validate && (\n              <Grid item>\n                <div\n                  style={{\n                    backgroundColor: \"#e3e9f2\",\n                    padding: \"8px 1rem\",\n                    borderRadius: \"3px\",\n                    border: \"1px solid rgb(0,158,224)\"\n                  }}\n                >\n                  <Typography variant=\"button\" color=\"primary\">\n                    <span>\n                      <AccessTime\n                        style={{\n                          verticalAlign: \"sub\",\n                          margin: \"0\",\n                          padding: \"0\"\n                        }}\n                      />{\" \"}\n                      Livraison : {delay}\n                    </span>\n                  </Typography>\n                </div>\n              </Grid>\n            )}\n            {pending && (\n              <Grid item>\n                <Button\n                  onClick={() => {\n                    handleStatus(id, 3, chargeId);\n                  }}\n                  variant=\"contained\"\n                  size=\"large\"\n                  color=\"secondary\"\n                  style={{ marginLeft: \"auto\" }}\n                >\n                  Refuser\n                </Button>\n              </Grid>\n            )}\n          </Grid>\n        )}\n      </StyledCardActions>\n    </div>\n  );\n};\n\nconst renderProducts = ({ cart }) => {\n  const GetIcon = ({ id }) => {\n    if (id === 1) {\n      return <LocalPizza />;\n    } else if (id === 2) {\n      return <LocalDining />;\n    } else if (id === 3) {\n      return <LocalCafe />;\n    } else if (id === 4) {\n      return <LocalBar />;\n    } else {\n      return null;\n    }\n  };\n  return cart.map((elt, i) => {\n    return (\n      <ListItem divider key={i} style={{ paddingLeft: 0 }}>\n        <Avatar>\n          <GetIcon id={elt.category_id} />\n        </Avatar>\n        <ListItemText primary={`${elt.quantity} x ${elt.name}`} />\n      </ListItem>\n    );\n  });\n};\n\nexport default OrderCard;\n"]},"metadata":{},"sourceType":"module"}