{"ast":null,"code":"import _objectWithoutProperties from \"/home/findev/Documents/lyon-0218-js-zappo/front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _toConsumableArray from \"/home/findev/Documents/lyon-0218-js-zappo/front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"/home/findev/Documents/lyon-0218-js-zappo/front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/findev/Documents/lyon-0218-js-zappo/front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/findev/Documents/lyon-0218-js-zappo/front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/findev/Documents/lyon-0218-js-zappo/front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/findev/Documents/lyon-0218-js-zappo/front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"/home/findev/Documents/lyon-0218-js-zappo/front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"/home/findev/Documents/lyon-0218-js-zappo/front/src/components/ContBasket.js\";\nimport React, { Component } from \"react\";\nimport MainHeader from \"./MainHeader\";\nimport \"react-times/css/classic/default.css\";\nimport { RootContainer } from \"../styled/Index\";\nimport BasketProductsList from \"./BasketComponents/BasketProductsList\";\nimport imageBasket from \"../assets/img/thumbShoppingCart.jpg\";\nimport axios from \"axios\";\nimport config from \"../assets/lib/axiosConfig\";\nimport timeToRangeWithInterval from \"../assets/js/timeToRange\";\nimport FooterPrice from \"./BasketComponents/FooterPrice\";\nimport { Button, Grid, Typography, Snackbar, Fade } from \"@material-ui/core\";\nimport { Alarm } from \"@material-ui/icons\";\nimport \"react-times/css/material/default.css\";\nimport { MuiPickersUtilsProvider, DatePicker } from \"material-ui-pickers\";\nimport MomentUtils from \"material-ui-pickers/utils/moment-utils\";\nimport moment from \"moment\";\nimport \"moment/locale/fr\";\nimport Emitter from \"../emitter\";\nimport { StyledDatePicker, StyledTimeContainer } from \"../styled/StyledTimePicker\";\n\nvar lunchTime = function lunchTime(today, delay, bool) {\n  console.log(\"t\", today);\n\n  if (today) {\n    return timeToRangeWithInterval(today.lunch_start_time, today.lunch_end_time, 15).reduce(function (ac, el) {\n      return ac.concat(el);\n    }, []);\n  }\n\n  return [];\n};\n\nvar dinnerTime = function dinnerTime(today) {\n  if (today) {\n    return timeToRangeWithInterval(today.dinner_start_time, today.dinner_end_time, 15).reduce(function (ac, el) {\n      return ac.concat(el);\n    }, []);\n  }\n\n  return [];\n};\n\nvar ContBasket =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(ContBasket, _Component);\n\n  function ContBasket(props) {\n    var _this;\n\n    _classCallCheck(this, ContBasket);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ContBasket).call(this, props));\n    _this.state = {\n      delay: 0,\n      snack: false,\n      today: {},\n      timeOpen: false,\n      products: [],\n      selectedDate: \"\",\n      timing: [],\n      exceptTiming: [],\n      maxDate: moment().add(1, \"month\"),\n      message: null\n    };\n    _this.restoreCart = _this.restoreCart.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.action = _this.action.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.handleDateChange = _this.handleDateChange.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.disableDays = _this.disableDays.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.handleTimeChange = _this.handleTimeChange.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.emitter = Emitter;\n    _this.checkTimeMessage = _this.checkTimeMessage.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    return _this;\n  }\n\n  _createClass(ContBasket, [{\n    key: \"restoreCart\",\n    value: function restoreCart() {\n      var tab = JSON.parse(localStorage.getItem(\"cart\"));\n\n      if (tab) {\n        this.setState({\n          products: tab\n        });\n      }\n    }\n  }, {\n    key: \"action\",\n    value: function action(id, _action) {\n      var _this2 = this;\n\n      var cart = _toConsumableArray(this.state.products);\n\n      var index = cart.findIndex(function (elt) {\n        return elt.id === id;\n      });\n\n      if (_action === \"up\") {\n        cart[index].quantity = cart[index].quantity + 1;\n      } else if (_action === \"down\") {\n        cart[index].quantity = cart[index].quantity - 1;\n\n        if (cart[index].quantity === 0) {\n          cart.splice(index, 1);\n        }\n      } else {\n        cart.splice(index, 1);\n      }\n\n      this.setState({\n        products: cart\n      }, function () {\n        var str = JSON.stringify(cart);\n        localStorage.setItem(\"cart\", str);\n\n        _this2.emitter.emit(\"refreshCart\"); // Listener prints \"5 10\".\n\n      });\n    }\n  }, {\n    key: \"handleTimeChange\",\n    value: function handleTimeChange(el) {\n      this.setState({\n        time: el,\n        timeOpen: !this.state.timeOpen\n      });\n      localStorage.setItem(\"dateTime\", el);\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this3 = this;\n\n      var time = moment();\n      var days = [6, 0, 1, 2, 3, 4, 5];\n      axios(config({}, \"/timing\", \"get\")).then(function (res) {\n        var _res$data = res.data,\n            timing = _res$data.timing,\n            exceptTiming = _res$data.exceptTiming,\n            delay = _res$data.delay;\n        var newTiming = days.map(function (el, i) {\n          var thisTime = timing[el];\n\n          if (thisTime.shift_lunch && thisTime.shift_dinner) {\n            return thisTime;\n          }\n\n          if (thisTime.shift_lunch) {\n            var dinner_start_time = thisTime.dinner_start_time,\n                dinner_end_time = thisTime.dinner_end_time,\n                myTime = _objectWithoutProperties(thisTime, [\"dinner_start_time\", \"dinner_end_time\"]);\n\n            return myTime;\n          }\n\n          if (thisTime.shift_dinner) {\n            var lunch_start_time = thisTime.lunch_start_time,\n                lunch_end_time = thisTime.lunch_end_time,\n                _myTime = _objectWithoutProperties(thisTime, [\"lunch_start_time\", \"lunch_end_time\"]);\n\n            return _myTime;\n          }\n\n          return null;\n        });\n        var now = moment();\n        var after = time.add(1, \"month\");\n        var tabOfOpenDay = [];\n\n        while (now.isAfter(after) === false) {\n          var matchDate = exceptTiming.map(function (el) {\n            return now.isBetween(moment(el.start_day, [\"LL\"]).subtract(1, \"days\").format(), moment(el.end_day, [\"LL\"]).add(1, \"days\").format());\n          });\n\n          if (!matchDate.includes(true)) {\n            tabOfOpenDay.push(now.format());\n          }\n\n          now.add(1, \"days\");\n        }\n\n        var thisDateTime = moment();\n        var selectedDate = tabOfOpenDay.length > 0 ? tabOfOpenDay[0] : thisDateTime.format();\n\n        var day = moment(selectedDate)._d.getDay();\n\n        var today = newTiming[day];\n\n        _this3.setState({\n          delay: delay.time,\n          today: today,\n          timing: newTiming,\n          exceptTiming: exceptTiming,\n          selectedDate: tabOfOpenDay.length > 0 ? tabOfOpenDay[0] : selectedDate\n        });\n\n        localStorage.setItem(\"dateOrder\", selectedDate);\n      });\n      this.restoreCart();\n    }\n  }, {\n    key: \"handleDateChange\",\n    value: function handleDateChange(date) {\n      var timing = this.state.timing;\n\n      var today = timing[date._d.getDay()];\n\n      var newDate = date.format();\n      localStorage.setItem(\"dateOrder\", newDate);\n      this.setState({\n        selectedDate: newDate,\n        today: today\n      });\n    }\n  }, {\n    key: \"disableDays\",\n    value: function disableDays(date) {\n      var _this$state = this.state,\n          exceptTiming = _this$state.exceptTiming,\n          timing = _this$state.timing;\n      var matchDate = exceptTiming.map(function (el) {\n        return date.isBetween(moment(el.start_day, [\"LL\"]).subtract(1, \"days\").format(), moment(el.end_day, [\"LL\"]).add(1, \"days\").format());\n      });\n\n      var thisDate = date._d.getDay();\n\n      if (timing[thisDate] === null || matchDate.includes(true)) {\n        return true;\n      } else {\n        return false;\n      }\n    }\n  }, {\n    key: \"checkTimeMessage\",\n    value: function checkTimeMessage() {\n      var time = this.state.time;\n\n      if (time) {\n        return true;\n      }\n\n      this.setState({\n        message: \"Veuillez selectionner une heure de retrait\"\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this4 = this;\n\n      var _this$state2 = this.state,\n          selectedDate = _this$state2.selectedDate,\n          timeOpen = _this$state2.timeOpen,\n          today = _this$state2.today,\n          time = _this$state2.time,\n          maxDate = _this$state2.maxDate,\n          products = _this$state2.products,\n          delay = _this$state2.delay;\n      console.log(\"delay\", delay);\n      var shift_lunch = today.shift_lunch,\n          shift_dinner = today.shift_dinner;\n      var history = this.props.history;\n      var now = moment();\n      var bool = now.isSame(selectedDate, \"days\");\n      var delivery = bool ? now.add(delay, \"minutes\") : now;\n      var lunch = lunchTime(today).filter(function (el) {\n        return console.log(moment(el, [\"LT\"]), delivery.format(\"LT\"));\n      } //    moment(el, [\"LT\"]).isAfter(delivery, [\"LT\"])\n      );\n      var dinner = dinnerTime(today).filter(function (el) {\n        return moment(el, [\"LT\"]).isAfter(delivery, [\"LT\"]);\n      });\n      return React.createElement(RootContainer, {\n        justify: \"space-between\",\n        onClick: function onClick(e) {\n          _this4.setState({\n            timeOpen: false\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 229\n        },\n        __self: this\n      }, React.createElement(MainHeader, Object.assign({}, this.props, {\n        pageTitle: \"Panier\",\n        redirect: function redirect() {\n          return history.goBack();\n        },\n        displayDateTime: products.length > 0 ? React.createElement(MuiPickersUtilsProvider, {\n          utils: MomentUtils,\n          moment: moment,\n          locale: \"fr\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 241\n          },\n          __self: this\n        }, React.createElement(StyledDatePicker, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 246\n          },\n          __self: this\n        }, \"A retirer :\", React.createElement(DatePicker, {\n          ref: function ref(el) {\n            return _this4.input = el;\n          },\n          className: \"selectDate\",\n          value: selectedDate,\n          ampm: \"false\",\n          disablePast: true,\n          onChange: this.handleDateChange,\n          format: \"Do MMM\",\n          maxDate: maxDate.format(\"YYYY-MM-DD\"),\n          shouldDisableDate: this.disableDays,\n          onOpen: function onOpen() {\n            return _this4.setState({\n              timeOpen: false\n            });\n          },\n          style: {\n            width: \"60px\",\n            color: \"#fff\",\n            padding: \"0 5px\",\n            margin: \"0\",\n            border: \"0px #fff\"\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 248\n          },\n          __self: this\n        }), lunch.length || dinner.length ? React.createElement(\"span\", {\n          style: {\n            display: \"flex\"\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 268\n          },\n          __self: this\n        }, time ? time : \"Heure\", React.createElement(Alarm, {\n          style: {\n            marginLeft: \"5px\",\n            color: \"rgb(0,158,224)\",\n            cursor: \"pointer\"\n          },\n          onClick: function onClick(e) {\n            e.stopPropagation();\n\n            _this4.input.setState({\n              open: false\n            });\n\n            _this4.setState({\n              timeOpen: !_this4.state.timeOpen\n            });\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 270\n          },\n          __self: this\n        })) : null)) : null,\n        titleAvatars: \"basket\",\n        image: imageBasket,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 235\n        },\n        __self: this\n      })), React.createElement(BasketProductsList, {\n        action: this.action,\n        products: this.state.products,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 291\n        },\n        __self: this\n      }), this.state.products.length > 0 && React.createElement(FooterPrice, Object.assign({\n        products: this.state.products,\n        checkMessage: this.checkTimeMessage,\n        time: time\n      }, this.props, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 296\n        },\n        __self: this\n      })), React.createElement(StyledTimeContainer, {\n        timeOpen: timeOpen,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 303\n        },\n        __self: this\n      }, shift_lunch && React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 305\n        },\n        __self: this\n      }, React.createElement(Grid, {\n        container: true,\n        justify: \"center\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 306\n        },\n        __self: this\n      }, React.createElement(Typography, {\n        variant: \"title\",\n        style: {\n          color: \"#fff\",\n          margin: \"0.6rem auto\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 307\n        },\n        __self: this\n      }, \"Midi\")), React.createElement(Grid, {\n        container: true,\n        justify: \"center\",\n        spacing: 8,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 314\n        },\n        __self: this\n      }, lunch.length && lunch.map(function (el, i) {\n        return React.createElement(Grid, {\n          item: true,\n          key: el + i,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 317\n          },\n          __self: this\n        }, React.createElement(Button, {\n          variant: \"contained\",\n          onClick: function onClick() {\n            return _this4.handleTimeChange(el);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 318\n          },\n          __self: this\n        }, el));\n      }), !lunch.length && React.createElement(Typography, {\n        variant: \"body1\",\n        style: {\n          color: \"#fff\",\n          margin: \"0.6rem auto\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 327\n        },\n        __self: this\n      }, \"Service Ferm\\xE9\"))), shift_dinner && React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 338\n        },\n        __self: this\n      }, React.createElement(Grid, {\n        container: true,\n        justify: \"center\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 339\n        },\n        __self: this\n      }, React.createElement(Typography, {\n        variant: \"title\",\n        style: {\n          color: \"#fff\",\n          margin: \"0.6rem auto\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 340\n        },\n        __self: this\n      }, \"Soir\")), React.createElement(Grid, {\n        container: true,\n        justify: \"center\",\n        spacing: 8,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 347\n        },\n        __self: this\n      }, dinner.map(function (el, i) {\n        return React.createElement(Grid, {\n          item: true,\n          key: el + i,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 349\n          },\n          __self: this\n        }, React.createElement(Button, {\n          variant: \"contained\",\n          onClick: function onClick() {\n            return _this4.handleTimeChange(el);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 350\n          },\n          __self: this\n        }, el));\n      })))), React.createElement(Snackbar, {\n        open: this.state.message !== null ? true : false,\n        autoHideDuration: 3000,\n        onClose: function onClose() {\n          return _this4.setState({\n            message: null\n          });\n        },\n        TransitionComponent: Fade,\n        ContentProps: {\n          \"aria-describedby\": \"message-id\"\n        },\n        message: React.createElement(\"span\", {\n          id: \"message-id\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 370\n          },\n          __self: this\n        }, this.state.message),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 362\n        },\n        __self: this\n      }));\n    }\n  }]);\n\n  return ContBasket;\n}(Component);\n\nexport default ContBasket; // if(!time && bool){\n//\n//   if (moment(delivery, ['LT']).isBetween(moment(today.lunch_start_time,['LT']),moment(today.lunch_end_time,['LT']))){\n//     if(lunch.length > 0){\n//       time = lunch[0]\n//     }\n//   }\n//   if (moment(delivery, ['LT']).isBetween(moment(today.dinner_start_time, ['LT']), moment(today.dinner_end_time, ['LT']))) {\n//     if(dinner.length > 0){\n//       time = dinner[0]\n//     }\n//   }\n//   if (moment(delivery, ['LT']).isBetween(moment(\"00:00\", ['LT']), moment(today.lunch_start_time, ['LT']))){\n//     if (lunch.length > 0) {\n//       time = lunch[0]\n//     }\n//   }\n//   if (moment(delivery, ['LT']).isBetween(moment(today.lunch_end_time, ['LT']), moment(today.dinner_start_time, ['LT']))) {\n//     if (dinner.length > 0) {\n//       time = dinner[0]\n//     }\n//   }\n// }","map":{"version":3,"sources":["/home/findev/Documents/lyon-0218-js-zappo/front/src/components/ContBasket.js"],"names":["React","Component","MainHeader","RootContainer","BasketProductsList","imageBasket","axios","config","timeToRangeWithInterval","FooterPrice","Button","Grid","Typography","Snackbar","Fade","Alarm","MuiPickersUtilsProvider","DatePicker","MomentUtils","moment","Emitter","StyledDatePicker","StyledTimeContainer","lunchTime","today","delay","bool","console","log","lunch_start_time","lunch_end_time","reduce","ac","el","concat","dinnerTime","dinner_start_time","dinner_end_time","ContBasket","props","state","snack","timeOpen","products","selectedDate","timing","exceptTiming","maxDate","add","message","restoreCart","bind","action","handleDateChange","disableDays","handleTimeChange","emitter","checkTimeMessage","tab","JSON","parse","localStorage","getItem","setState","id","cart","index","findIndex","elt","quantity","splice","str","stringify","setItem","emit","time","days","then","res","data","newTiming","map","i","thisTime","shift_lunch","shift_dinner","myTime","now","after","tabOfOpenDay","isAfter","matchDate","isBetween","start_day","subtract","format","end_day","includes","push","thisDateTime","length","day","_d","getDay","date","newDate","thisDate","history","isSame","delivery","lunch","filter","dinner","e","goBack","input","width","color","padding","margin","border","display","marginLeft","cursor","stopPropagation","open"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport MainHeader from \"./MainHeader\";\nimport \"react-times/css/classic/default.css\";\nimport { RootContainer } from \"../styled/Index\";\nimport BasketProductsList from \"./BasketComponents/BasketProductsList\";\nimport imageBasket from \"../assets/img/thumbShoppingCart.jpg\";\nimport axios from \"axios\";\nimport config from \"../assets/lib/axiosConfig\";\nimport timeToRangeWithInterval from \"../assets/js/timeToRange\";\nimport FooterPrice from \"./BasketComponents/FooterPrice\";\nimport { Button, Grid, Typography, Snackbar, Fade } from \"@material-ui/core\";\nimport { Alarm } from \"@material-ui/icons\";\nimport \"react-times/css/material/default.css\";\nimport { MuiPickersUtilsProvider, DatePicker } from \"material-ui-pickers\";\nimport MomentUtils from \"material-ui-pickers/utils/moment-utils\";\nimport moment from \"moment\";\nimport \"moment/locale/fr\";\nimport Emitter from \"../emitter\";\nimport {\n\tStyledDatePicker,\n\tStyledTimeContainer\n} from \"../styled/StyledTimePicker\";\n\nconst lunchTime = (today, delay, bool) => {\n\tconsole.log(\"t\", today);\n\tif (today) {\n\t\treturn timeToRangeWithInterval(\n\t\t\ttoday.lunch_start_time,\n\t\t\ttoday.lunch_end_time,\n\t\t\t15\n\t\t).reduce((ac, el) => ac.concat(el), []);\n\t}\n\treturn [];\n};\nconst dinnerTime = today => {\n\tif (today) {\n\t\treturn timeToRangeWithInterval(\n\t\t\ttoday.dinner_start_time,\n\t\t\ttoday.dinner_end_time,\n\t\t\t15\n\t\t).reduce((ac, el) => ac.concat(el), []);\n\t}\n\treturn [];\n};\n\nclass ContBasket extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = {\n\t\t\tdelay: 0,\n\t\t\tsnack: false,\n\t\t\ttoday: {},\n\t\t\ttimeOpen: false,\n\t\t\tproducts: [],\n\t\t\tselectedDate: \"\",\n\t\t\ttiming: [],\n\t\t\texceptTiming: [],\n\t\t\tmaxDate: moment().add(1, \"month\"),\n\t\t\tmessage: null\n\t\t};\n\t\tthis.restoreCart = this.restoreCart.bind(this);\n\t\tthis.action = this.action.bind(this);\n\t\tthis.handleDateChange = this.handleDateChange.bind(this);\n\t\tthis.disableDays = this.disableDays.bind(this);\n\t\tthis.handleTimeChange = this.handleTimeChange.bind(this);\n\t\tthis.emitter = Emitter;\n\t\tthis.checkTimeMessage = this.checkTimeMessage.bind(this);\n\t}\n\n\trestoreCart() {\n\t\tconst tab = JSON.parse(localStorage.getItem(\"cart\"));\n\t\tif (tab) {\n\t\t\tthis.setState({\n\t\t\t\tproducts: tab\n\t\t\t});\n\t\t}\n\t}\n\n\taction(id, action) {\n\t\tconst cart = [...this.state.products];\n\t\tconst index = cart.findIndex(elt => elt.id === id);\n\t\tif (action === \"up\") {\n\t\t\tcart[index].quantity = cart[index].quantity + 1;\n\t\t} else if (action === \"down\") {\n\t\t\tcart[index].quantity = cart[index].quantity - 1;\n\t\t\tif (cart[index].quantity === 0) {\n\t\t\t\tcart.splice(index, 1);\n\t\t\t}\n\t\t} else {\n\t\t\tcart.splice(index, 1);\n\t\t}\n\t\tthis.setState(\n\t\t\t{\n\t\t\t\tproducts: cart\n\t\t\t},\n\t\t\t() => {\n\t\t\t\tconst str = JSON.stringify(cart);\n\t\t\t\tlocalStorage.setItem(\"cart\", str);\n\t\t\t\tthis.emitter.emit(\"refreshCart\"); // Listener prints \"5 10\".\n\t\t\t}\n\t\t);\n\t}\n\n\thandleTimeChange(el) {\n\t\tthis.setState({\n\t\t\ttime: el,\n\t\t\ttimeOpen: !this.state.timeOpen\n\t\t});\n\t\tlocalStorage.setItem(\"dateTime\", el);\n\t}\n\n\tcomponentDidMount() {\n\t\tconst time = moment();\n\t\tconst days = [6, 0, 1, 2, 3, 4, 5];\n\t\taxios(config({}, \"/timing\", \"get\")).then(res => {\n\t\t\tconst { timing, exceptTiming, delay } = res.data;\n\t\t\tconst newTiming = days.map((el, i) => {\n\t\t\t\tconst thisTime = timing[el];\n\t\t\t\tif (thisTime.shift_lunch && thisTime.shift_dinner) {\n\t\t\t\t\treturn thisTime;\n\t\t\t\t}\n\t\t\t\tif (thisTime.shift_lunch) {\n\t\t\t\t\tconst { dinner_start_time, dinner_end_time, ...myTime } = thisTime;\n\t\t\t\t\treturn myTime;\n\t\t\t\t}\n\t\t\t\tif (thisTime.shift_dinner) {\n\t\t\t\t\tconst { lunch_start_time, lunch_end_time, ...myTime } = thisTime;\n\t\t\t\t\treturn myTime;\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t});\n\t\t\tconst now = moment();\n\t\t\tconst after = time.add(1, \"month\");\n\t\t\tconst tabOfOpenDay = [];\n\t\t\twhile (now.isAfter(after) === false) {\n\t\t\t\tconst matchDate = exceptTiming.map(el =>\n\t\t\t\t\tnow.isBetween(\n\t\t\t\t\t\tmoment(el.start_day, [\"LL\"])\n\t\t\t\t\t\t\t.subtract(1, \"days\")\n\t\t\t\t\t\t\t.format(),\n\t\t\t\t\t\tmoment(el.end_day, [\"LL\"])\n\t\t\t\t\t\t\t.add(1, \"days\")\n\t\t\t\t\t\t\t.format()\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t\tif (!matchDate.includes(true)) {\n\t\t\t\t\ttabOfOpenDay.push(now.format());\n\t\t\t\t}\n\t\t\t\tnow.add(1, \"days\");\n\t\t\t}\n\t\t\tconst thisDateTime = moment();\n\t\t\tconst selectedDate =\n\t\t\t\ttabOfOpenDay.length > 0 ? tabOfOpenDay[0] : thisDateTime.format();\n\t\t\tconst day = moment(selectedDate)._d.getDay();\n\t\t\tconst today = newTiming[day];\n\t\t\tthis.setState({\n\t\t\t\tdelay: delay.time,\n\t\t\t\ttoday,\n\t\t\t\ttiming: newTiming,\n\t\t\t\texceptTiming,\n\t\t\t\tselectedDate: tabOfOpenDay.length > 0 ? tabOfOpenDay[0] : selectedDate\n\t\t\t});\n\t\t\tlocalStorage.setItem(\"dateOrder\", selectedDate);\n\t\t});\n\t\tthis.restoreCart();\n\t}\n\n\thandleDateChange(date) {\n\t\tconst { timing } = this.state;\n\t\tconst today = timing[date._d.getDay()];\n\t\tconst newDate = date.format();\n\t\tlocalStorage.setItem(\"dateOrder\", newDate);\n\t\tthis.setState({ selectedDate: newDate, today });\n\t}\n\n\tdisableDays(date) {\n\t\tconst { exceptTiming, timing } = this.state;\n\t\tconst matchDate = exceptTiming.map(el =>\n\t\t\tdate.isBetween(\n\t\t\t\tmoment(el.start_day, [\"LL\"])\n\t\t\t\t\t.subtract(1, \"days\")\n\t\t\t\t\t.format(),\n\t\t\t\tmoment(el.end_day, [\"LL\"])\n\t\t\t\t\t.add(1, \"days\")\n\t\t\t\t\t.format()\n\t\t\t)\n\t\t);\n\t\tconst thisDate = date._d.getDay();\n\t\tif (timing[thisDate] === null || matchDate.includes(true)) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tcheckTimeMessage() {\n\t\tconst { time } = this.state;\n\t\tif (time) {\n\t\t\treturn true;\n\t\t}\n\t\tthis.setState({ message: \"Veuillez selectionner une heure de retrait\" });\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\tselectedDate,\n\t\t\ttimeOpen,\n\t\t\ttoday,\n\t\t\ttime,\n\t\t\tmaxDate,\n\t\t\tproducts,\n\t\t\tdelay\n\t\t} = this.state;\n\t\tconsole.log(\"delay\", delay);\n\t\tconst { shift_lunch, shift_dinner } = today;\n\t\tconst { history } = this.props;\n\t\tconst now = moment();\n\t\tconst bool = now.isSame(selectedDate, \"days\");\n\t\tconst delivery = bool ? now.add(delay, \"minutes\") : now;\n\n\t\tconst lunch = lunchTime(today).filter(\n\t\t\tel => console.log(moment(el, [\"LT\"]), delivery.format(\"LT\"))\n\t\t\t//    moment(el, [\"LT\"]).isAfter(delivery, [\"LT\"])\n\t\t);\n\t\tconst dinner = dinnerTime(today).filter(el =>\n\t\t\tmoment(el, [\"LT\"]).isAfter(delivery, [\"LT\"])\n\t\t);\n\t\treturn (\n\t\t\t<RootContainer\n\t\t\t\tjustify=\"space-between\"\n\t\t\t\tonClick={e => {\n\t\t\t\t\tthis.setState({ timeOpen: false });\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<MainHeader\n\t\t\t\t\t{...this.props}\n\t\t\t\t\tpageTitle=\"Panier\"\n\t\t\t\t\tredirect={() => history.goBack()}\n\t\t\t\t\tdisplayDateTime={\n\t\t\t\t\t\tproducts.length > 0 ? (\n\t\t\t\t\t\t\t<MuiPickersUtilsProvider\n\t\t\t\t\t\t\t\tutils={MomentUtils}\n\t\t\t\t\t\t\t\tmoment={moment}\n\t\t\t\t\t\t\t\tlocale=\"fr\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<StyledDatePicker>\n\t\t\t\t\t\t\t\t\tA retirer :\n\t\t\t\t\t\t\t\t\t<DatePicker\n\t\t\t\t\t\t\t\t\t\tref={el => (this.input = el)}\n\t\t\t\t\t\t\t\t\t\tclassName=\"selectDate\"\n\t\t\t\t\t\t\t\t\t\tvalue={selectedDate}\n\t\t\t\t\t\t\t\t\t\tampm=\"false\"\n\t\t\t\t\t\t\t\t\t\tdisablePast={true}\n\t\t\t\t\t\t\t\t\t\tonChange={this.handleDateChange}\n\t\t\t\t\t\t\t\t\t\tformat=\"Do MMM\"\n\t\t\t\t\t\t\t\t\t\tmaxDate={maxDate.format(\"YYYY-MM-DD\")}\n\t\t\t\t\t\t\t\t\t\tshouldDisableDate={this.disableDays}\n\t\t\t\t\t\t\t\t\t\tonOpen={() => this.setState({ timeOpen: false })}\n\t\t\t\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\t\t\t\twidth: \"60px\",\n\t\t\t\t\t\t\t\t\t\t\tcolor: \"#fff\",\n\t\t\t\t\t\t\t\t\t\t\tpadding: \"0 5px\",\n\t\t\t\t\t\t\t\t\t\t\tmargin: \"0\",\n\t\t\t\t\t\t\t\t\t\t\tborder: \"0px #fff\"\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t{lunch.length || dinner.length ? (\n\t\t\t\t\t\t\t\t\t\t<span style={{ display: \"flex\" }}>\n\t\t\t\t\t\t\t\t\t\t\t{time ? time : \"Heure\"}\n\t\t\t\t\t\t\t\t\t\t\t<Alarm\n\t\t\t\t\t\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\t\t\t\t\t\tmarginLeft: \"5px\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tcolor: \"rgb(0,158,224)\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tcursor: \"pointer\"\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={e => {\n\t\t\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis.input.setState({ open: false });\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis.setState({ timeOpen: !this.state.timeOpen });\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t) : null}\n\t\t\t\t\t\t\t\t</StyledDatePicker>\n\t\t\t\t\t\t\t</MuiPickersUtilsProvider>\n\t\t\t\t\t\t) : null\n\t\t\t\t\t}\n\t\t\t\t\ttitleAvatars=\"basket\"\n\t\t\t\t\timage={imageBasket}\n\t\t\t\t/>\n\t\t\t\t<BasketProductsList\n\t\t\t\t\taction={this.action}\n\t\t\t\t\tproducts={this.state.products}\n\t\t\t\t/>\n\t\t\t\t{this.state.products.length > 0 && (\n\t\t\t\t\t<FooterPrice\n\t\t\t\t\t\tproducts={this.state.products}\n\t\t\t\t\t\tcheckMessage={this.checkTimeMessage}\n\t\t\t\t\t\ttime={time}\n\t\t\t\t\t\t{...this.props}\n\t\t\t\t\t/>\n\t\t\t\t)}\n\t\t\t\t<StyledTimeContainer timeOpen={timeOpen}>\n\t\t\t\t\t{shift_lunch && (\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Grid container justify=\"center\">\n\t\t\t\t\t\t\t\t<Typography\n\t\t\t\t\t\t\t\t\tvariant=\"title\"\n\t\t\t\t\t\t\t\t\tstyle={{ color: \"#fff\", margin: \"0.6rem auto\" }}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tMidi\n\t\t\t\t\t\t\t\t</Typography>\n\t\t\t\t\t\t\t</Grid>\n\t\t\t\t\t\t\t<Grid container justify=\"center\" spacing={8}>\n\t\t\t\t\t\t\t\t{lunch.length &&\n\t\t\t\t\t\t\t\t\tlunch.map((el, i) => (\n\t\t\t\t\t\t\t\t\t\t<Grid item key={el + i}>\n\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"contained\"\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => this.handleTimeChange(el)}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t{el}\n\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t</Grid>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t{!lunch.length && (\n\t\t\t\t\t\t\t\t\t<Typography\n\t\t\t\t\t\t\t\t\t\tvariant=\"body1\"\n\t\t\t\t\t\t\t\t\t\tstyle={{ color: \"#fff\", margin: \"0.6rem auto\" }}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\tService Fermé\n\t\t\t\t\t\t\t\t\t</Typography>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</Grid>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t\t{shift_dinner && (\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Grid container justify=\"center\">\n\t\t\t\t\t\t\t\t<Typography\n\t\t\t\t\t\t\t\t\tvariant=\"title\"\n\t\t\t\t\t\t\t\t\tstyle={{ color: \"#fff\", margin: \"0.6rem auto\" }}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tSoir\n\t\t\t\t\t\t\t\t</Typography>\n\t\t\t\t\t\t\t</Grid>\n\t\t\t\t\t\t\t<Grid container justify=\"center\" spacing={8}>\n\t\t\t\t\t\t\t\t{dinner.map((el, i) => (\n\t\t\t\t\t\t\t\t\t<Grid item key={el + i}>\n\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\tvariant=\"contained\"\n\t\t\t\t\t\t\t\t\t\t\tonClick={() => this.handleTimeChange(el)}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{el}\n\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t</Grid>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</Grid>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</StyledTimeContainer>\n\t\t\t\t<Snackbar\n\t\t\t\t\topen={this.state.message !== null ? true : false}\n\t\t\t\t\tautoHideDuration={3000}\n\t\t\t\t\tonClose={() => this.setState({ message: null })}\n\t\t\t\t\tTransitionComponent={Fade}\n\t\t\t\t\tContentProps={{\n\t\t\t\t\t\t\"aria-describedby\": \"message-id\"\n\t\t\t\t\t}}\n\t\t\t\t\tmessage={<span id=\"message-id\">{this.state.message}</span>}\n\t\t\t\t/>\n\t\t\t</RootContainer>\n\t\t);\n\t}\n}\n\nexport default ContBasket;\n\n// if(!time && bool){\n//\n\n//   if (moment(delivery, ['LT']).isBetween(moment(today.lunch_start_time,['LT']),moment(today.lunch_end_time,['LT']))){\n//     if(lunch.length > 0){\n//       time = lunch[0]\n//     }\n//   }\n//   if (moment(delivery, ['LT']).isBetween(moment(today.dinner_start_time, ['LT']), moment(today.dinner_end_time, ['LT']))) {\n//     if(dinner.length > 0){\n//       time = dinner[0]\n//     }\n//   }\n//   if (moment(delivery, ['LT']).isBetween(moment(\"00:00\", ['LT']), moment(today.lunch_start_time, ['LT']))){\n//     if (lunch.length > 0) {\n//       time = lunch[0]\n//     }\n//   }\n//   if (moment(delivery, ['LT']).isBetween(moment(today.lunch_end_time, ['LT']), moment(today.dinner_start_time, ['LT']))) {\n//     if (dinner.length > 0) {\n//       time = dinner[0]\n//     }\n//   }\n// }\n"]},"metadata":{},"sourceType":"module"}