{"code":"import * as tslib_1 from \"tslib\";\r\nimport { getPoseValues } from '../inc/selectors';\r\nexport var resolveProp = function (target, props) {\r\n    return typeof target === 'function' ? target(props) : target;\r\n};\r\nvar poseDefault = function (pose, prop, defaultValue, resolveProps) {\r\n    return pose && pose[prop] !== undefined\r\n        ? resolveProp(pose[prop], resolveProps)\r\n        : defaultValue;\r\n};\r\nvar startChildAnimations = function (children, next, pose, props) {\r\n    var animations = [];\r\n    var delay = poseDefault(pose, 'delayChildren', 0, props);\r\n    var stagger = poseDefault(pose, 'staggerChildren', 0, props);\r\n    var staggerDirection = poseDefault(pose, 'staggerDirection', 1, props);\r\n    var maxStaggerDuration = (children.size - 1) * stagger;\r\n    var generateStaggerDuration = staggerDirection === 1\r\n        ? function (i) { return i * stagger; }\r\n        : function (i) { return maxStaggerDuration - i * stagger; };\r\n    Array.from(children).forEach(function (child, i) {\r\n        animations.push(child.set(next, tslib_1.__assign({}, props, { delay: delay + generateStaggerDuration(i) })));\r\n    });\r\n    return animations;\r\n};\r\nvar resolveTransition = function (transition, key, value, props, convertTransitionDefinition, getInstantTransition) {\r\n    var resolvedTransition;\r\n    if (typeof transition === 'function') {\r\n        resolvedTransition = transition(props);\r\n    }\r\n    else if (transition[key]) {\r\n        if (typeof transition[key] === 'function') {\r\n            resolvedTransition = transition[key](props);\r\n        }\r\n        else {\r\n            resolvedTransition = transition[key];\r\n        }\r\n    }\r\n    else {\r\n        resolvedTransition = transition;\r\n    }\r\n    return resolvedTransition === false\r\n        ? getInstantTransition(value, props)\r\n        : convertTransitionDefinition(value, resolvedTransition, props);\r\n};\r\nvar createPoseSetter = function (setterProps) { return function (next, nextProps) {\r\n    if (nextProps === void 0) { nextProps = {}; }\r\n    var state = setterProps.state, poses = setterProps.poses, startAction = setterProps.startAction, stopAction = setterProps.stopAction, getInstantTransition = setterProps.getInstantTransition, addActionDelay = setterProps.addActionDelay, getTransitionProps = setterProps.getTransitionProps, resolveTarget = setterProps.resolveTarget, transformPose = setterProps.transformPose, convertTransitionDefinition = setterProps.convertTransitionDefinition;\r\n    var children = state.children, values = state.values, props = state.props, activeActions = state.activeActions, activePoses = state.activePoses;\r\n    var _a = nextProps.delay, delay = _a === void 0 ? 0 : _a;\r\n    var hasChildren = children.size;\r\n    var nextPose = poses[next];\r\n    var baseTransitionProps = tslib_1.__assign({}, props, nextProps);\r\n    var getChildAnimations = function () {\r\n        return hasChildren\r\n            ? startChildAnimations(children, next, nextPose, baseTransitionProps)\r\n            : [];\r\n    };\r\n    var getParentAnimations = function () {\r\n        if (!nextPose)\r\n            return [];\r\n        if (transformPose)\r\n            nextPose = transformPose(nextPose, next, state);\r\n        var preTransition = nextPose.preTransition, getTransition = nextPose.transition;\r\n        if (preTransition)\r\n            nextPose.preTransition(baseTransitionProps);\r\n        return Object.keys(getPoseValues(nextPose)).map(function (key) {\r\n            return new Promise(function (complete) {\r\n                var value = values.get(key);\r\n                var transitionProps = tslib_1.__assign({}, baseTransitionProps, { key: key,\r\n                    value: value });\r\n                var target = resolveTarget(value, resolveProp(nextPose[key], transitionProps));\r\n                if (activeActions.has(key))\r\n                    stopAction(activeActions.get(key));\r\n                var resolveTransitionProps = tslib_1.__assign({ to: target }, transitionProps, getTransitionProps(value, target, transitionProps));\r\n                var transition = resolveTransition(getTransition, key, value, resolveTransitionProps, convertTransitionDefinition, getInstantTransition);\r\n                var poseDelay = resolveProp(nextPose.delay, transitionProps);\r\n                if (delay || poseDelay) {\r\n                    transition = addActionDelay(delay || poseDelay, transition);\r\n                }\r\n                activeActions.set(key, startAction(value, transition, complete));\r\n                activePoses.set(key, next);\r\n            });\r\n        });\r\n    };\r\n    if (nextPose && hasChildren) {\r\n        if (resolveProp(nextPose.beforeChildren, baseTransitionProps)) {\r\n            return Promise.all(getParentAnimations()).then(function () {\r\n                return Promise.all(getChildAnimations());\r\n            });\r\n        }\r\n        else if (resolveProp(nextPose.afterChildren, baseTransitionProps)) {\r\n            return Promise.all(getChildAnimations()).then(function () {\r\n                return Promise.all(getParentAnimations());\r\n            });\r\n        }\r\n    }\r\n    return Promise.all(getParentAnimations().concat(getChildAnimations()));\r\n}; };\r\nexport default createPoseSetter;\r\n//# sourceMappingURL=setter.js.map","map":"{\"version\":3,\"file\":\"setter.js\",\"sourceRoot\":\"\",\"sources\":[\"../src/factories/setter.ts\"],\"names\":[],\"mappings\":\"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\"}"}
